<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Report</title>

    <h1>Sezione Report</h1>
    <script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js"></script>


    <meta name="viewport"
          content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" type="text/css" href="report.css">
</head>

<body>
<!--HTML e JS Chatbot-->
    <div id="responseArea">

        </div>

    <div id="CBButtonList" style="display:none;">
            <button id="CBButtonA" class="CBButton" value="Infarto" onclick="sendRequest('Infarto')">Infarto</button>
            <hr>
            <button id="CBButtonB" class="CBButtonLine" value="Tachicardia" onclick="sendRequest('Tachicardia')">Tachicardia</button>
            <hr>
            <button id="CBButtonC" class="CBButtonLine" value="Pressione Alta" onclick="sendRequest('Pressione Alta')">Pressione Alta</button>
            <hr>
            <button id="CBButtonD" class="CBButtonLine" value="Pressione Bassa" onclick="sendRequest('Pressione Bassa')">Pressione Bassa</button>
            <hr>
            <button id="CBButtonE" class="CBButtonLine" value="Febbre" onclick="sendRequest('Febbre')">Febbre</button>
        </div>


        <script>
        function hide() {
            const variable = document.getElementById('CBButtonList');
            if (variable.style.display == "block") {
                variable.style.display = "none";
            } else {
                variable.style.display = "block";
            }
        }


    </script>

    <script type="text/javascript" src="/ChatBot/ChatBotScript"></script>

   <!--fine Chatbot -->


<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script src = "./AreaPredizioni/NotificaRischio.js"></script>

   <!-- <input type="text" id="daterange"/>
<script>
    $(function() {
        $('input[name="daterange"]').daterangepicker({
            opens: 'left'
        }, function(start, end, label) {
            console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
        });

    });
</script>-->

<script>
            function generate() {
                Repclear();
                //prende la data e la mette nell'uri
                var date = new Date(document.getElementById("startDate").value);
                formattedStartDate = date.getFullYear() + "-" + (date.getMonth()+ 1) + "-" + date.getDate();

                var date = new Date(document.getElementById("endDate").value);
                formattedEndDate = date.getFullYear() + "-" + (date.getMonth()+ 1) + "-" + date.getDate();

                range = formattedStartDate + "," + formattedEndDate;
                console.log(range)
                //let element = document.getElementById("daterange");
                let string = "http://localhost:8080/Report?daterange="+ encodeURIComponent(range);

                let report = document.createElement("a");
                report.href = string;
                report.innerHTML = "Visualizza Report";
                report.download = "Report.pdf";
                document.getElementById("date").append(report);
                InserisciReport(range);
    }
        function Repclear() {
            document.getElementById("date").innerHTML = "";
        }

        //fa una get di un arraylist di device entro un range e li inserisce nell'hmtl
        function InserisciReport(range) {

           req = new XMLHttpRequest()
            var maxIteration = 30;
            req.onload = function () {
                clear();
                const responseArray = JSON.parse(this.responseText);
                let element = document.getElementById("stampa");
                element.innerHTML="";
                for (let i in responseArray) {
                    if(maxIteration < i)
                       break;

                    let node = document.createElement("tr");
                    node.append(responseArray[i]);
                   element.append(node)

                }
            }

            req.open("POST", "/Report/getReports", true);
            req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            req.send("daterange="+range);
       }

        </script>

    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <button onClick="generate()">Crea Report</button>
    <div id="date">
    </div>
<table id="stampa">    </table>

<!--Barra Navigazionale-->
    <nav style="right: 195px;">
            <a href="index.html">Device</a>
            <a href="AreaPredizioni.html" ><input type="radio"  class="check">Area Predizioni</a>
            <a href="Report.html">Report</a>
            <a onclick="javascript:hide()"> Chatbot</a>
            <div class="animation start-report"></div>
    </nav>
</body>
</html>